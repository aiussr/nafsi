<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>D3 Radial Sketch</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }
    
    #chart {
      background: #ffffff;
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
    }
    
    /* Basic text styling */
    .title {
      font-size: 24px;
      font-weight: bold;
      text-anchor: middle;
    }
    .subtitle {
      font-size: 14px;
      fill: #555;
      text-anchor: middle;
    }
    .authority-title {
      font-size: 14px;
      font-weight: bold;
      text-anchor: middle;
      fill: #fff;
    }
    .authority-bullet {
      font-size: 11px;
      fill: #fff;
      text-anchor: middle;
    }
    .case-title {
      font-size: 12px;
      font-weight: bold;
      text-anchor: middle;
      fill: #333;
    }
    .case-bullet {
      font-size: 10px;
      text-anchor: middle;
      fill: #333;
    }
    
    /* Info box styling */
    .info-box {
      fill: #f9f9f9;
      stroke: #ccc;
      stroke-width: 1;
    }
    .info-title {
      font-size: 14px;
      font-weight: bold;
      text-anchor: middle;
      fill: #333;
    }
    .info-text {
      font-size: 11px;
      fill: #555;
      text-anchor: start;
    }
    
    /* Zone of Acceptance circle */
    .zone-circle {
      fill: none;
      stroke: #999;
      stroke-dasharray: 4,2;
    }
    
    /* Legitimacy Core */
    .core-circle {
      fill: #f0f0f0;
      stroke: #666;
      stroke-width: 1;
    }
    
    /* Authority shape */
    .authority-node {
      cursor: pointer;
    }
    .authority-box {
      rx: 10;
      ry: 10;
      stroke: none;
      fill-opacity: 0.9;
    }
    
    /* Case studies */
    .case-node {
      cursor: pointer;
    }
    .case-circle {
      stroke-width: 1.5;
    }
    
    /* Lines */
    .connection {
      fill: none;
      stroke-width: 2;
      stroke-opacity: 0.7;
    }
    .connection:hover {
      stroke-opacity: 1;
      stroke-width: 3;
    }
    
    /* Tooltip styling */
    .tooltip {
      position: absolute;
      padding: 8px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      pointer-events: none;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.2s;
    }
  </style>
</head>
<body>

<div id="chart"></div>
<div class="tooltip"></div>

<script>
// ========================================================================
// 1) Basic setup
// ========================================================================
const width = 1000;
const height = 800;
const centerX = width / 2;
const centerY = height / 2 - 50; // a bit above center for space below

// Create an SVG container
const svg = d3.select("#chart")
  .append("svg")
  .attr("width", width)
  .attr("height", height);

// Tooltip
const tooltip = d3.select(".tooltip");

// ========================================================================
// 2) Data Definitions (Simplified)
// ========================================================================

// Five authorities
const authorities = [
  {
    id: "formal",
    title: "Formal Authority",
    bullets: [
      "84% compliance legit",
      "42% if questioned",
      "(Tyler & Huo, 2002)"
    ],
    color: "#4568DC"
  },
  {
    id: "expert",
    title: "Expert Authority",
    bullets: [
      "3.2x greater influence",
      "(Cross & Prusak, 2002)"
    ],
    color: "#56ab2f"
  },
  {
    id: "moral",
    title: "Moral Authority",
    bullets: [
      "+35% voluntary effort",
      "-22% monitoring",
      "(Brown et al., 2005)"
    ],
    color: "#b24592"
  },
  {
    id: "social",
    title: "Social Authority",
    bullets: [
      "Centrality → Influence",
      "r=0.74 across 38 orgs",
      "(Brass & Burkhardt)"
    ],
    color: "#FF8008"
  },
  {
    id: "digital",
    title: "Digital Authority",
    bullets: [
      "31% more shift",
      "Response time factor",
      "(Gibson & Cohen, 2003)"
    ],
    color: "#03A9F4"
  }
];

// Some sample case studies
const caseStudies = [
  {
    id: "trump",
    name: "Trump",
    bullets: ["$5.9B media value", "4-5x engagement"],
    color: "#e74c3c",
    connections: ["social", "moral"]
  },
  {
    id: "cohn",
    name: "Cohn",
    bullets: ["Gatekeeper", "17 daily calls"],
    color: "#9b59b6",
    connections: ["formal", "social"]
  },
  {
    id: "muhammad",
    name: "Muhammad",
    bullets: ["Charismatic → Inst."],
    color: "#3498db",
    connections: ["moral", "formal", "social"]
  }
];

// For demonstration: Each authority will be placed radially
// around the center. The radius for that ring:
const authorityRadius = 200; 

// We also define a ring for the zone of acceptance
const zoneRadius = authorityRadius + 30;

// Place the case studies along the bottom in a row
// We'll compute an x spacing for them
const csStartX = 150;
const csStartY = 600;
const csSpacing = 150;

// ========================================================================
// 3) Draw the Title & Center Elements
// ========================================================================

// Title
svg.append("text")
  .attr("class", "title")
  .attr("x", centerX)
  .attr("y", 40)
  .text("Evidence-Based Authority Framework");

// Subtitle
svg.append("text")
  .attr("class", "subtitle")
  .attr("x", centerX)
  .attr("y", 65)
  .text("A Radial Sketch with D3");

// Zone of Acceptance (dashed circle behind authorities)
svg.append("circle")
  .attr("class", "zone-circle")
  .attr("cx", centerX)
  .attr("cy", centerY)
  .attr("r", zoneRadius)
  .attr("stroke", "#999")
  .attr("stroke-width", 2)
  .attr("fill", "none");

// Zone label
svg.append("text")
  .attr("x", centerX + zoneRadius + 10)
  .attr("y", centerY)
  .attr("font-size", 12)
  .attr("fill", "#555")
  .text("Zone of Acceptance (Barnard)");

// Legitimacy Core
svg.append("circle")
  .attr("class", "core-circle")
  .attr("cx", centerX)
  .attr("cy", centerY)
  .attr("r", 80);

svg.append("text")
  .attr("x", centerX)
  .attr("y", centerY - 5)
  .attr("text-anchor", "middle")
  .attr("font-size", 14)
  .attr("font-weight", "bold")
  .text("Legitimacy Core");

svg.append("text")
  .attr("x", centerX)
  .attr("y", centerY + 15)
  .attr("text-anchor", "middle")
  .attr("font-size", 11)
  .attr("fill", "#666")
  .text("(Tyler: voluntary compliance)");

// ========================================================================
// 4) Draw the Authorities Radially
// ========================================================================

// Calculate angular spacing
const angleStep = (2 * Math.PI) / authorities.length;

// Group for each authority
const authorityGroup = svg.selectAll(".authority-group")
  .data(authorities)
  .enter()
  .append("g")
  .attr("class", "authority-node")
  .attr("transform", (d, i) => {
    const angle = i * angleStep - Math.PI / 2; // start from top
    const ax = centerX + authorityRadius * Math.cos(angle);
    const ay = centerY + authorityRadius * Math.sin(angle);
    return `translate(${ax}, ${ay})`;
  })
  .on("mouseover", (event, d) => {
    tooltip
      .style("opacity", 1)
      .html(`
        <strong>${d.title}</strong><br/>
        ${d.bullets.join("<br/>")}
      `)
      .style("left", (event.pageX + 10) + "px")
      .style("top", (event.pageY - 20) + "px");
  })
  .on("mouseout", () => {
    tooltip.style("opacity", 0);
  });

// The background rectangle for each authority
authorityGroup.append("rect")
  .attr("class", "authority-box")
  .attr("x", -60)     // shift rect center
  .attr("y", -40)
  .attr("width", 120)
  .attr("height", 80)
  .attr("rx", 10)
  .attr("ry", 10)
  .attr("fill", d => d.color);

// Authority title
authorityGroup.append("text")
  .attr("class", "authority-title")
  .attr("y", -15)
  .text(d => d.title);

// Display bullet points
authorityGroup.each(function(d) {
  const g = d3.select(this);
  d.bullets.forEach((bullet, idx) => {
    g.append("text")
      .attr("class", "authority-bullet")
      .attr("y", 5 + idx * 12)
      .text(bullet);
  });
});

// Lines from each authority to the Core
authorityGroup.append("line")
  .attr("class", "connection")
  .attr("stroke", d => d.color)
  .attr("x1", 0)
  .attr("y1", 0)
  .attr("x2", (d, i) => {
    // each authority group is already at [ax, ay],
    // so (0,0) is the authority's position
    // we want to draw from (0,0) to the negative of that vector
    // but we only want to go to the Core center
    // simpler approach: set x2,y2 to the negative offset from the parent's transform
    // but let's do an absolute line:
    // We'll just do a small line length
    // or we can do a path for a curve, but let's keep it simple
    return (centerX - (centerX + authorityRadius * Math.cos(i * angleStep - Math.PI/2)));
  })
  .attr("y2", (d, i) => {
    return (centerY - (centerY + authorityRadius * Math.sin(i * angleStep - Math.PI/2)));
  })
  .attr("stroke-dasharray", "3,2");

// ========================================================================
// 5) Case Studies in a Row at the Bottom
// ========================================================================
const caseGroup = svg.selectAll(".case-node")
  .data(caseStudies)
  .enter()
  .append("g")
  .attr("class", "case-node")
  .attr("transform", (d, i) => {
    const x = csStartX + i * csSpacing;
    const y = csStartY;
    return `translate(${x}, ${y})`;
  })
  .on("mouseover", (event, d) => {
    tooltip
      .style("opacity", 1)
      .html(`
        <strong>${d.name}</strong><br/>
        ${d.bullets.join("<br/>")}
      `)
      .style("left", (event.pageX + 10) + "px")
      .style("top", (event.pageY - 20) + "px");
  })
  .on("mouseout", () => {
    tooltip.style("opacity", 0);
  });

// Circle for each case study
caseGroup.append("circle")
  .attr("class", "case-circle")
  .attr("r", 30)
  .attr("fill", "#fff")
  .attr("stroke", d => d.color);

// Title + bullet under the circle
caseGroup.append("text")
  .attr("class", "case-title")
  .attr("y", -40)
  .text(d => d.name);

caseGroup.each(function(d) {
  const g = d3.select(this);
  d.bullets.forEach((b, idx) => {
    g.append("text")
      .attr("class", "case-bullet")
      .attr("y", 45 + idx * 12)
      .text(b);
  });
});

// Lines from each case study to relevant authorities
caseGroup.each(function(studyData) {
  const g = d3.select(this);
  studyData.connections.forEach(authorityID => {
    // find the authority's position
    const authorityObj = authorities.find(a => a.id === authorityID);
    const i = authorities.indexOf(authorityObj);
    const angle = i * angleStep - Math.PI/2;
    
    // Authority absolute position
    const ax = centerX + authorityRadius * Math.cos(angle);
    const ay = centerY + authorityRadius * Math.sin(angle);
    
    // Our current group is at x,y
    const transform = g.attr("transform"); // "translate(x, y)"
    const regex = /translate\(([^,]+),\s?([^,]+)\)/;
    const match = regex.exec(transform);
    const cx = parseFloat(match[1]);
    const cy = parseFloat(match[2]);
    
    // Draw a path or line
    svg.append("line")
      .attr("class", "connection")
      .attr("x1", cx)
      .attr("y1", cy)
      .attr("x2", ax)
      .attr("y2", ay)
      .attr("stroke", studyData.color);
  });
});

// ========================================================================
// 6) Info Box Example (Right Side) 
// ========================================================================
const infoG = svg.append("g")
  .attr("transform", `translate(${width - 280}, 100)`);

infoG.append("rect")
  .attr("class", "info-box")
  .attr("width", 250)
  .attr("height", 140)
  .attr("rx", 6)
  .attr("ry", 6);

infoG.append("text")
  .attr("class", "info-title")
  .attr("x", 125)
  .attr("y", 25)
  .text("Extra Insights");

const extraItems = [
  "• Cultural variations matter",
  "• Balanced authority mix → success",
  "• Observe voluntary compliance range"
];

extraItems.forEach((item, i) => {
  infoG.append("text")
    .attr("class", "info-text")
    .attr("x", 15)
    .attr("y", 50 + i * 20)
    .text(item);
});

// ========================================================================
// 7) That's it! This is just a sketch to illustrate the layout approach.
//    You'd refine styling, positions, bullet text, etc. for final usage.
// ========================================================================
</script>

</body>
</html>
